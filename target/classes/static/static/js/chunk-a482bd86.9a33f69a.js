(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a482bd86"],{"01ea":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return l})),a.d(e,"a",(function(){return i}));var s="/wm",l="http://114.242.60.27:8090",i="production"},"0d55":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form",{attrs:{"label-width":"40px","label-position":"left",size:"small"}},[a("el-form-item",{attrs:{label:"年度"}},[a("select-year",{ref:"selectYear",on:{change:t.handleChangeYear}})],1)],1),t._v(" "),a("div",{staticClass:"tree-card",attrs:{shadow:"never"}},[a("el-tabs",{model:{value:t.current.treeTab,callback:function(e){t.$set(t.current,"treeTab",e)},expression:"current.treeTab"}},[a("el-tab-pane",{attrs:{label:"部门",name:"dept"}},[a("el-tree",{attrs:{data:t.tree.dept.data,props:t.tree.dept.props,"node-key":"id","expand-on-click-node":!1},on:{"node-click":t.getTableData}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"筹划任务分类",name:"task"}},[a("el-tree",{attrs:{data:t.tree.task.data,props:t.tree.task.props,"node-key":"id","expand-on-click-node":!1},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,l=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{on:{click:function(e){return t.getTableData(l)}}},[t._v(t._s(s.label))]),t._v(" "),a("span",{staticClass:"custom-tree-handle"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return t.openNewBuildWork(l)}}},[t._v("新建任务")]),t._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return t.handleAppendTree(l)}}},[t._v("添加")]),t._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return t.handleEditTree(l)}}},[t._v("修改")]),t._v(" "),"0"!==l.parent_id?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return t.handleRemoveTree(s,l)}}},[t._v("删除")]):t._e()],1)])}}])})],1)],1)],1)],1),t._v(" "),t.ui.showTable?a("el-col",{attrs:{span:18}},[a("el-form",{attrs:{"label-width":"40px","label-position":"left",size:"small",inline:!0}},["task"===t.current.treeTab?[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleAddTask}},[t._v("新建应急保障任务")])],1),t._v(" "),a("el-form-item",[a("el-upload",{staticClass:"filter-item filter-item-upload",attrs:{action:t.baseUrl+"/task/taskother/addbylist",data:{class_id:t.current.class_id},"on-success":t.handleUploadSuccess,"show-file-list":!1}},[a("el-button",{attrs:{type:"primary"}},[t._v("批量导入")])],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleDistributionYear}},[t._v("分配年份")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleUpdateStudio}},[t._v("分配作业室")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleUpdateClass}},[t._v("修改分类")])],1)]:t._e(),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleManyTaskRelease}},[t._v("批量下达")])],1),t._v(" "),a("el-form-item",[a("el-button",{staticClass:"fl",attrs:{type:"primary",size:"small"},on:{click:t.handleExport}},[t._v("导出")])],1)],2),t._v(" "),a("TableLayout",{attrs:{"current-page":t.table.page.pageNum,"page-size":t.table.page.pageSize,total:t.table.page.total},on:{"page-change":t.handleCurrentChange}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:t.table.data,"highlight-current-row":"",border:""},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",label:"全选",width:"55",fixed:""}}),t._v(" "),t._l(t.table.labels,(function(t){return a("el-table-column",{key:t.prop,attrs:{label:t.label,prop:t.prop,width:"160"}})})),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"warning",icon:"el-icon-bottom"},on:{click:function(a){return t.handleTaskRelease(e.row)}}},[t._v("下达")]),t._v(" "),a("el-link",{attrs:{type:"primary",icon:"el-icon-folder"},on:{click:function(a){return t.handleTaskDetails(e.row)}}},[t._v("详情")]),t._v(" "),a("el-link",{attrs:{type:"info",icon:"el-icon-edit"},on:{click:function(a){return t.handleTaskEdit(e.row)}}},[t._v("修改")])]}}],null,!1,3853299129)})],2)],1)],1):t._e()],1),t._v(" "),a("task-dialog",{ref:"taskDialog",on:{update:t.getTableData,"update-year":t.handleUpdateYear}}),t._v(" "),a("el-dialog",{staticClass:"detailDialog",attrs:{title:"任务详情",visible:t.detailPeopleVisible,width:"900px",top:"5vh","close-on-click-modal":!1},on:{"update:visible":function(e){t.detailPeopleVisible=e}}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            中文名称:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.map_cn_name)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            图号:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.map_code)+"\n          ")])],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            地理区域:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.map_area)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            \t海图类型:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.map_type)+"\n          ")])],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            比例尺:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.map_scale)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            资料状态:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.map_state)+"\n          ")])],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            东图廓经度:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.east_lon)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            北图廓纬度:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.north_lat)+"\n          ")])],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            南图廓纬度:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.south_lat)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            西图廓经度:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.west_lon)+"\n          ")])],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            新资料面积占比:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.xzlmjzb)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            通告改正数:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.tggzs)+"\n          ")])],1)],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            版次:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.bc)+"\n          ")])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-col",{attrs:{span:8}},[t._v("\n            库存情况:\n          ")]),t._v(" "),a("el-col",{attrs:{span:12}},[t._v("\n            "+t._s(t.kcqk)+"\n          ")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"新建任务","close-on-click-modal":!1,visible:t.neWorkForm.workVisible,width:"500px"},on:{"update:visible":function(e){return t.$set(t.neWorkForm,"workVisible",e)}}},[a("el-form",{ref:"neWorktDialog",attrs:{model:t.neWorkForm.form,size:"small"}},[a("el-form-item",{attrs:{label:"任务名称",prop:"task_name","label-width":"80px",rules:[{required:!0,message:"任务名称不能为空"}]}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.neWorkForm.form.task_name,callback:function(e){t.$set(t.neWorkForm.form,"task_name",e)},expression:"neWorkForm.form.task_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"图号",prop:"data_code","label-width":"80px",rules:[{required:!0,message:"图号不能为空"}]}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.neWorkForm.form.data_code,callback:function(e){t.$set(t.neWorkForm.form,"data_code",e)},expression:"neWorkForm.form.data_code"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleNewWork("neWorktDialog")}}},[t._v("确 定")])],1)],1)],1)},l=[],i=(a("a7e5"),a("1bc7"),a("0c84"),a("28f8")),n=a("01ea"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"新建应急保障任务",visible:t.addTask.visible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.addTask,"visible",e)}}},[a("el-form",{ref:"addTaskForm",attrs:{rules:t.addTask.rules,model:t.addTask.form,"label-width":t.addTask.formLabelWidth}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"序号"}},[a("el-input",{model:{value:t.addTask.form.index_id,callback:function(e){t.$set(t.addTask.form,"index_id",e)},expression:"addTask.form.index_id"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"对应编号/记录编号",prop:"otask_code"}},[a("el-input",{model:{value:t.addTask.form.otask_code,callback:function(e){t.$set(t.addTask.form,"otask_code",e)},expression:"addTask.form.otask_code"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务名称",prop:"otask_name"}},[a("el-input",{model:{value:t.addTask.form.otask_name,callback:function(e){t.$set(t.addTask.form,"otask_name",e)},expression:"addTask.form.otask_name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务来源",prop:"otask_source"}},[a("el-input",{model:{value:t.addTask.form.otask_source,callback:function(e){t.$set(t.addTask.form,"otask_source",e)},expression:"addTask.form.otask_source"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"下达人员",prop:"otask_maker"}},[a("el-input",{model:{value:t.addTask.form.otask_maker,callback:function(e){t.$set(t.addTask.form,"otask_maker",e)},expression:"addTask.form.otask_maker"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"承担单位",prop:"otask_unit"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择作业室"},model:{value:t.addTask.form.otask_unit,callback:function(e){t.$set(t.addTask.form,"otask_unit",e)},expression:"addTask.form.otask_unit"}},t._l(t.studio.options,(function(t){return a("el-option",{key:t.label,attrs:{label:t.prop,value:t.prop}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"参与兵力",prop:"otask_people"}},[a("el-input",{model:{value:t.addTask.form.otask_people,callback:function(e){t.$set(t.addTask.form,"otask_people",e)},expression:"addTask.form.otask_people"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"下达时间",prop:"task_start_date"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.addTask.form.task_start_date,callback:function(e){t.$set(t.addTask.form,"task_start_date",e)},expression:"addTask.form.task_start_date"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"具体内容",prop:"otask_content"}},[a("el-input",{model:{value:t.addTask.form.otask_content,callback:function(e){t.$set(t.addTask.form,"otask_content",e)},expression:"addTask.form.otask_content"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"完成数量"}},[a("el-input",{model:{value:t.addTask.form.otask_count,callback:function(e){t.$set(t.addTask.form,"otask_count",e)},expression:"addTask.form.otask_count"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"任务折算"}},[a("el-input",{model:{value:t.addTask.form.otask_works,callback:function(e){t.$set(t.addTask.form,"otask_works",e)},expression:"addTask.form.otask_works"}})],1)],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:t.closeAddTaskDialog}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.submitAddTaskDialog}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"添加部门",visible:t.addDeptTree.visible,width:"400px"},on:{"update:visible":function(e){return t.$set(t.addDeptTree,"visible",e)}}},[a("el-form",{attrs:{model:t.addDeptTree.form,"label-width":t.addDeptTree.formLabelWidth}},[a("el-form-item",{attrs:{label:"部门名称"}},[a("el-input",{model:{value:t.addDeptTree.form.dept_name,callback:function(e){t.$set(t.addDeptTree.form,"dept_name",e)},expression:"addDeptTree.form.dept_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{model:{value:t.addDeptTree.form.remark,callback:function(e){t.$set(t.addDeptTree.form,"remark",e)},expression:"addDeptTree.form.remark"}})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.closeAddDeptTreeDialog()}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleAddDeptTree()}}},[t._v("确定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"年份分配",visible:t.year.visible,width:"300px"},on:{"update:visible":function(e){return t.$set(t.year,"visible",e)}}},[a("el-form",{ref:"yearForm",attrs:{model:t.year.form,"label-width":t.year.formLabelWidth}},[a("el-form-item",{attrs:{label:"",prop:"task_year",rules:[{required:!0,message:"请输入正确的年份",trigger:"blur",pattern:/^[1|2]\d{3}/},{type:"number",message:"请输入正确的年份"}]}},[a("el-input",{attrs:{maxlength:"4"},model:{value:t.year.form.task_year,callback:function(e){t.$set(t.year.form,"task_year",t._n(e))},expression:"year.form.task_year"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.closeYearDialog}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.submitYearDialog}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"作业室分配",visible:t.studio.visible,width:"300px"},on:{"update:visible":function(e){return t.$set(t.studio,"visible",e)}}},[a("el-form",{attrs:{model:t.studio.form,"label-width":t.studio.formLabelWidth}},[a("el-form-item",{attrs:{label:""}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择作业室"},model:{value:t.studio.form.selected,callback:function(e){t.$set(t.studio.form,"selected",e)},expression:"studio.form.selected"}},t._l(t.studio.options,(function(t){return a("el-option",{key:t.label,attrs:{label:t.prop,value:t.label}})})),1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.closeStudioDialog}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.submitStudioDialog}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"修改分类",visible:t.updateClass.visible,width:"300px"},on:{"update:visible":function(e){return t.$set(t.updateClass,"visible",e)}}},[t.updateClass.tree.data?a("div",[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:t.updateClass.filterText,callback:function(e){t.$set(t.updateClass,"filterText",e)},expression:"updateClass.filterText"}}),t._v(" "),a("el-radio-group",{model:{value:t.updateClass.form.task_class_id,callback:function(e){t.$set(t.updateClass.form,"task_class_id",e)},expression:"updateClass.form.task_class_id"}},[a("el-tree",{ref:"updateClassTree",attrs:{data:t.updateClass.tree.data,props:t.updateClass.tree.props,"filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,l=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("el-radio",{attrs:{label:l.class_id}},[t._v(t._s(s.label))])],1)])}}],null,!1,308869543)})],1)],1):a("div",{staticStyle:{"text-align":"center"}},[t._v("暂无数据")]),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.closeUpdateClassDialog}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.submitUpdateClassDialog}},[t._v("确 定")])],1)])],1)},r=[],d=(a("ac67"),a("32ea"),a("6797")),c=a("b199"),u=a("857b");function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function _(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={components:{},props:{},data:function(){return{addTask:{class_id:"",visible:!1,form:{index_id:"",otask_code:"",otask_name:"",otask_source:"",otask_maker:"",otask_unit:"",otask_people:"",otask_content:"",otask_works:"",otask_count:""},formLabelWidth:"150px",rules:{otask_code:[{required:!0,message:"不能为空",trigger:"blur"}],otask_name:[{required:!0,message:"不能为空",trigger:"blur"}],otask_source:[{required:!0,message:"不能为空",trigger:"blur"}],otask_maker:[{required:!0,message:"不能为空",trigger:"blur"}],otask_unit:[{required:!0,message:"不能为空",trigger:"blur"}],otask_people:[{required:!0,message:"不能为空",trigger:"blur"}],task_start_date:[{required:!0,message:"不能为空",trigger:"blur"}],otask_content:[{required:!0,message:"不能为空",trigger:"blur"}]}},addDeptTree:{visible:!1,form:{},formLabelWidth:"120px"},addPort:{visible:!1,form:{},formLabelWidth:"120px"},year:{visible:!1,form:{},formLabelWidth:"0px"},studio:{options:[],visible:!1,form:{},formLabelWidth:"0px"},updateClass:{visible:!1,form:{task_class_id:""},filterText:"",tree:{data:[],props:{children:"childList",label:"class_name"}}}}},watch:{"updateClass.filterText":function(t){this.$refs.updateClassTree.filter(t)}},mounted:function(){this.getOptions()},destroyed:function(){},methods:{getOptions:function(){var t=this;d["b"].getAllZuoyeshiList().then((function(e){t.studio.options=e.data})),c["j"].selectcode().then((function(e){t.addTask.form.otask_code=e.data}))},openAddTaskDialog:function(t){console.log(this.addTask.form),Object(u["g"])(this,"addTaskForm"),this.addTask.class_id=t,this.addTask.visible=!0},closeAddTaskDialog:function(){this.addTask.visible=!1,Object(u["a"])(this.addTask.form)},submitAddTaskDialog:function(){var t=this;if(!Object(u["j"])(this,"addTaskForm"))return!1;c["j"].add(_({class_id:this.addTask.class_id},this.addTask.form)).then((function(e){Object(u["i"])(t,e).then((function(){t.closeAddTaskDialog(),t.$emit("update")}))}))},openAddDeptTreeDialog:function(t){this.addDeptTree.visible=!0},closeAddDeptTreeDialog:function(){this.addDeptTree.visible=!1,this.addDeptTree.form={}},handleAddDeptTree:function(){d["b"].addDept(this.addDeptTree.form).then((function(t){console.log(t)}))},openYearDialog:function(t){this.year.index_id_list=t,this.year.visible=!0},closeYearDialog:function(){this.year.visible=!1,this.year.form={},Object(u["g"])(this,"yearForm")},submitYearDialog:function(){var t=this;if(!Object(u["j"])(this,"yearForm"))return!1;c["h"].updateyearlist(_({index_id_list:this.year.index_id_list},this.year.form)).then((function(e){Object(u["i"])(t,e).then((function(){t.closeYearDialog(),t.$emit("update"),t.$emit("update-year")}))}))},handleChangeYear:function(t){this.year.form.task_year=t},openStudioDialog:function(t){this.studio.task_index_id=t,this.studio.visible=!0},closeStudioDialog:function(){this.studio.visible=!1,this.studio.form={}},submitStudioDialog:function(){var t=this,e=this.studio.form.selected,a=e.length;if(0===a)return this.$message.error("请选择"),!1;var s=this.studio.task_index_id,l=e.map((function(t){return{dept_id:t,task_index_id:s}})),i=null;if(a>1)i=c["f"].addlist(l);else{i=c["f"].addlist(l)}i.then((function(e){Object(u["i"])(t,e).then((function(){t.closeStudioDialog(),t.$emit("update")}))}))},handleTreeNodeClick:function(t){this.updateClass.form.task_class_id=t.class_id},filterNode:function(t,e){return!t||(!e.class_name||-1!==e.class_name.indexOf(t))},openUpdateClassDialog:function(t,e){var a=this;c["d"].gettreeEdit({calss_id:t}).then((function(t){a.updateClass.tree.data=t.data[0]?t.data[0].childList:[],a.updateClass.index_id=e,0===t.data.length||null===t.data[0].childList||0===t.data[0].childList.length?a.$message.warning("没有子类可以做分类修改!"):a.updateClass.visible=!0,console.log(a.updateClass.form.task_class_id)}))},closeUpdateClassDialog:function(){this.updateClass.visible=!1,this.updateClass.form={}},submitUpdateClassDialog:function(){var t=this;c["h"].updateclass({index_id:this.updateClass.index_id,task_class_id:this.updateClass.form.task_class_id}).then((function(e){Object(u["i"])(t,e).then((function(){t.closeUpdateClassDialog(),t.$emit("update")}))}))}}},f=m,h=(a("d407"),a("5d22")),k=Object(h["a"])(f,o,r,!1,null,"097368bc",null),b=k.exports,v=a("18ed"),g=a("ada5"),T={components:{TaskDialog:b,SelectYear:v["a"],TableLayout:g["a"]},data:function(){var t;return t={baseUrl:n["b"],detailPeopleVisible:!1,searchData:{class_id:"54A89E793FA24141B4C5FB13FE80AC1D",dept_id:"",task_year:"",page_number:1,page_size:10},treeNodesData:null,neWorkForm:{workVisible:!1,form:{task_name:"",data_code:"",data_name:"",child_id_list:[],dept_id:"",dept_name:"",index_id:"",is_task_dept:0,task_class_id:"",task_class_tag:"",task_data_id:"",task_end_date:"",task_print_date:"",task_rate:"",task_rate_describe:"",task_remark:"",task_state:"",task_type:"",task_year:""}},current:{from:"",class_id:"",treeTab:"task",treeData:{}},ui:{showYear:!1,showTaskBtns:!1,showTable:!1},tree:{dept:{data:[],props:{children:"childNodes",label:"nodeName"}},task:{data:[],props:{children:"childList",label:"class_name"}}},table:{page:{},labels:[],data:[],multipleSelection:[]},tableLoading:!1,tggzs:"",west_lon:"",east_lon:"",xzlmjzb:"",south_lat:"",source_state:"",sfgb:"",publish_unit:"",publish_date:"",north_lat:"",map_type:"",map_scale:"",map_en_name:"",map_code:"",map_cn_name:"",map_state:""},Object(i["a"])(t,"map_cn_name",""),Object(i["a"])(t,"bc",""),Object(i["a"])(t,"kcqk",""),Object(i["a"])(t,"map_area",""),t},computed:{multipleSelectionData:function(){return this.table.multipleSelection.map((function(t){return t.index_id})).join(",")}},mounted:function(){var t=this;this.getTree().then((function(e){t.initData(e[1].data)})),this.getTableData()},methods:{getTree:function(){var t=this,e=c["d"].getdepttree().then((function(e){return t.tree.dept.data=e.data.childNodes,e})),a=c["d"].gettree({class_type:0}).then((function(e){return t.tree.task.data=e.data,e}));return Promise.all([e,a])},initData:function(t){var e=this,a=t.filter((function(t){return t.class_id===e.searchData.class_id}));if(a.length>0){var s=a[0];this.current.class_id=s.class_id,this.current.treeData=s.childList}},handleReset:function(){this.searchData.page_number=1,this.ui.showTable=!1,this.ui.showTaskBtns=!1,this.table.multipleSelection=[],this.getTableData()},getTableData:function(t){var e=this;this.tableLoading=!0;var a=this.current.treeTab;t&&(this.current.treeData=t.childList||[],"dept"===a?(console.log(t),this.searchData.class_id=t.nodeID,this.searchData.dept_id=t.pid):(this.searchData.class_id=t.class_id,this.searchData.dept_id="",this.current.class_id=t.class_id));var s=Object(u["e"])(this.searchData);this.ui.showTable=!0,this.getTableHeader().then((function(){return e.ui.showYear=!0,e.ui.showTaskBtns="task"===a,"dept"===a?e.getDeptTableData(s):e.getTaskTableData(s)})).then((function(t){e.tableLoading=!1,t.data&&t.data.list?(e.table.page=t.data,e.table.data=t.data.list):(e.table.data=[],e.table.page={})})).catch((function(t){e.$message.info(t),e.removeTableData()}))},getTableHeader:function(){var t=this;return new Promise((function(e,a){console.log(t.searchData.class_id),c["d"].fieldbyid({class_id:t.searchData.class_id}).then((function(s){s.data.length<=0&&a("没有数据"),t.table.labels=s.data,e(!0)}))}))},getDeptTableData:function(t){return c["h"].selectTasklist(t)},getTaskTableData:function(t){return c["h"].checklist(t)},removeTableData:function(){this.table.labels=[],this.table.data=[]},checkTaskRelease:function(t){var e=t.findIndex((function(t){return"下发"===t.task_state}));return!(e>=0)||(this.$message.error("不能重复下达！"),!1)},handleTaskRelease:function(t){var e=this;return!!this.checkMultipleSelection()&&(!!this.checkTaskRelease(this.table.multipleSelection)&&(!!this.checkTaskRelease([t])&&(!!this.checkMultipleSelection()&&(!!this.checkTaskRelease(this.table.multipleSelection)&&(console.log(this.multipleSelectionData),void c["h"].updatestatelist({index_id_list:t.index_id,task_state:"XF"}).then((function(t){Object(u["i"])(e,t),200===t.code&&e.handleReset()})))))))},handleTaskUpdate:function(t){},handleTaskDelete:function(t,e){var a=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c["h"].delete({index_id:t}).then((function(t){Object(u["i"])(a,t),a.handleReset()}))})).catch((function(){}))},handleTaskItemRemove:function(t){this.table.data.splice(t,1)},handleAddTask:function(){this.$refs.taskDialog.openAddTaskDialog(this.current.class_id)},checkMultipleSelection:function(){return console.log(this.multipleSelectionData),!(this.table.multipleSelection.length<=0)||(this.$message.error("请进行勾选！"),!1)},handleUpdateYear:function(){this.$refs.selectYear.getData()},handleDistributionYear:function(){if(!this.checkMultipleSelection())return!1;this.$refs.taskDialog.openYearDialog(this.multipleSelectionData)},handleUpdateStudio:function(){if(!this.checkMultipleSelection())return!1;this.$refs.taskDialog.openStudioDialog(this.multipleSelectionData)},handleUpdateClass:function(){if(!this.checkMultipleSelection())return!1;this.$refs.taskDialog.openUpdateClassDialog(this.current.class_id,this.multipleSelectionData)},handleManyTaskRelease:function(){var t=this;return!!this.checkMultipleSelection()&&(!!this.checkTaskRelease(this.table.multipleSelection)&&(console.log(this.multipleSelectionData),void c["h"].updatestatelist({index_id_list:this.multipleSelectionData,task_state:"XF"}).then((function(e){Object(u["i"])(t,e),200===e.code&&t.handleReset()}))))},messageInfo:function(t){this.$message({message:t.message,type:"warning"})},openNewBuildWork:function(t){this.neWorkForm.workVisible=!0,this.treeNodesData=t,Object(u["g"])(this,"neWorktDialog")},resetForm:function(){this.neWorkForm.form={task_name:"",data_code:""}},handleNewWork:function(t){var e=this;this.$refs[t].validate((function(t){if(t){var a=e.neWorkForm.form;a.task_class_id=e.treeNodesData.class_id,c["h"].addTask(a).then((function(t){e.resetForm(),200==t.code?e.getTableData():e.messageInfo(t)})),e.neWorkForm.workVisible=!1}}))},handleAppendTree:function(t){var e=this;this.$prompt("","添加分类",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{1,50}$/,inputErrorMessage:"分类名称不能为空"}).then((function(a){var s=a.value;c["d"].add({class_order:1,class_name:s,parent_id:t.class_id}).then((function(t){Object(u["i"])(e,t),e.getTree()}))})).catch((function(){}))},handleTaskEdit:function(t){var e=this;console.log(t),this.$prompt("请输入任务名称","修改任务名称",{inputValue:t.task_name,confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{1,50}$/,inputErrorMessage:"任务名称不能为空"}).then((function(a){var s=a.value;c["h"].updateTaskName({task_name:s,task_index_id:t.index_id}).then((function(t){e.getTableData(),Object(u["i"])(e,t)}))})).catch((function(){}))},handleEditTree:function(t){var e=this;this.$prompt("","修改分类",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:t.class_name}).then((function(a){var s=a.value;c["d"].update({class_order:1,class_id:t.class_id,class_name:s,class_remark:""}).then((function(t){Object(u["i"])(e,t)})),t.class_name=s})).catch((function(){}))},handleRemoveTree:function(t,e){var a=this;"0"===e.parent_id?this.$message.warning("根节点不能删除!"):this.$confirm("确认删除分类?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c["d"].delete({class_id:e.class_id}).then((function(s){Object(u["i"])(a,s);var l=t.parent,i=l.data.childList||l.data,n=i.findIndex((function(t){return t.class_id===e.class_id}));i.splice(n,1)}))})).catch((function(){}))},handleUploadSuccess:function(t){Object(u["i"])(this,t)},handleChangeYear:function(t){this.searchData.task_year=t,this.handleReset()},handleSelectionChange:function(t,e){this.table.multipleSelection=t},handleExport:function(){if(!this.checkMultipleSelection())return!1;console.log(this.searchData),c["h"].checklistexport(this.searchData).then((function(t){Object(u["c"])(t,"任务管理")}))},handlePrint:function(){window.print()},handleCurrentChange:function(t){this.searchData.page_number=t,this.getTableData()},handleTaskDetails:function(t){var e=this;console.log(t),c["h"].checkTaskInfo({mapId:t.task_data_id}).then((function(t){200===t.code&&(e.detailPeopleVisible=!0,e.tggzs=t.data.tggzs,e.west_lon=t.data.west_lon,e.xzlmjzb=t.data.xzlmjzb,e.south_lat=t.data.south_lat,e.source_state=t.data.source_state,e.sfgb=t.data.sfgb,e.publish_unit=t.data.publish_unit,e.publish_date=t.data.publish_date,e.north_lat=t.data.north_lat,e.map_type=t.data.map_type,e.map_scale=t.data.map_scale,e.map_en_name=t.data.map_en_name,e.map_code=t.data.map_code,e.map_cn_name=t.data.map_cn_name,e.map_state=t.data.map_state,e.map_cn_name=t.data.map_cn_name,e.bc=t.data.bc,e.kcqk=t.data.kcqk,e.map_area=t.data.map_area,e.east_lon=t.data.east_lon)}))},handleAddCategory:function(){var t=this;this.$prompt("","添加分类",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var a=e.value;c["d"].add({class_order:1,class_name:a,parent_id:0}).then((function(e){Object(u["i"])(t,e),t.getTree()}))})).catch((function(){}))}}},D=T,y=(a("d8c3"),Object(h["a"])(D,s,l,!1,null,"cdcef738",null));e["default"]=y.exports},"0df8":function(t,e,a){},4673:function(t,e,a){},d407:function(t,e,a){"use strict";a("4673")},d8c3:function(t,e,a){"use strict";a("0df8")}}]);