(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d229c0f"],{df90:function(e,t,a){"use strict";a.r(t);var o,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",[a("el-form",{attrs:{inline:"",model:e.searchData,size:"small"}},[a("el-form-item",{attrs:{label:"年度","label-width":"70px"}},[a("select-year",{on:{change:e.handleChangeYear}})],1),e._v(" "),a("el-form-item",{attrs:{label:"任务状态"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchData.project_state,callback:function(t){e.$set(e.searchData,"project_state",t)},expression:"searchData.project_state"}},[a("el-option",{attrs:{value:"待处理"}}),e._v(" "),a("el-option",{attrs:{value:"正在处理"}}),e._v(" "),a("el-option",{attrs:{value:"处理完成"}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}},[e._v("搜索")])],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right"}},[a("span",[e._v("共计："+e._s(e.page.total)+"个")])])],1)],1),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.table.data}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"项目名称",prop:"project_name"}}),e._v(" "),a("el-table-column",{attrs:{label:"项目类型",prop:"project_state"}}),e._v(" "),a("el-table-column",{attrs:{label:"下达人员",prop:"project_maker"}}),e._v(" "),a("el-table-column",{attrs:{label:"周期",prop:"project_cycle"}}),e._v(" "),a("el-table-column",{attrs:{label:"下达时间",prop:"project_startdate"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium"},on:{click:function(a){return e.openDialog(t.row)}}},[e._v("人员与进度")])]}}])})],1),e._v(" "),a("pagination",{attrs:{"current-page":e.page.current,"page-size":10,total:e.page.total},on:{"page-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"人员分配与进度提交",visible:e.dialog.add.visible,width:"1200px"},on:{"update:visible":function(t){return e.$set(e.dialog.add,"visible",t)}}},[a("h3",[e._v("人员与工天分配")]),e._v(" "),a("el-form",{ref:"addForm",attrs:{inline:"",model:e.dialog.add.form,size:"small"}},[a("el-form-item",{attrs:{label:"实施过程",prop:"project_rate",rules:[{required:!0,message:"不能空"}]}},[a("el-select",{model:{value:e.dialog.add.form.project_rate,callback:function(t){e.$set(e.dialog.add.form,"project_rate",t)},expression:"dialog.add.form.project_rate"}},e._l(e.ssgcOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"负责人",prop:"project_rate",rules:[{required:!0,message:"不能空"}]}},[a("el-select",{model:{value:e.dialog.add.form.project_oper,callback:function(t){e.$set(e.dialog.add.form,"project_oper",t)},expression:"dialog.add.form.project_oper"}},e._l(e.personOptions,(function(e){return a("el-option",{key:e.user_name,attrs:{label:e.user_name,value:e.user_name}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"工天",prop:"project_rate",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{attrs:{placeholder:"请输入内容",clearable:"",type:"number",step:"0.01",min:"0",onkeyup:"this.value= this.value.match(/\\d+(\\.\\d{0,2})?/) ? this.value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''"},model:{value:e.dialog.add.form.project_days,callback:function(t){e.$set(e.dialog.add.form,"project_days",t)},expression:"dialog.add.form.project_days"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开始时间",prop:"project_startdate",rules:[{required:!0,message:"不能空"}]}},[a("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"开始时间"},model:{value:e.dialog.add.form.project_startdate,callback:function(t){e.$set(e.dialog.add.form,"project_startdate",t)},expression:"dialog.add.form.project_startdate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"project_enddate",rules:[{required:!0,message:"不能空"}]}},[a("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"结束时间"},model:{value:e.dialog.add.form.project_enddate,callback:function(t){e.$set(e.dialog.add.form,"project_enddate",t)},expression:"dialog.add.form.project_enddate"}})],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:e.handleDistributionAdd}},[e._v("添加")])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.table.distributeData}},[a("el-table-column",{attrs:{label:"过程",prop:"project_rate",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.project_rate))]):a("el-select",{model:{value:e.dialog.edit.form.project_rate,callback:function(t){e.$set(e.dialog.edit.form,"project_rate",t)},expression:"dialog.edit.form.project_rate"}},e._l(e.ssgcOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"人员",prop:"project_oper",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.project_oper))]):a("el-input",{model:{value:e.dialog.edit.form.project_oper,callback:function(t){e.$set(e.dialog.edit.form,"project_oper",t)},expression:"dialog.edit.form.project_oper"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"工天",prop:"project_days",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.project_days))]):a("el-input",{model:{value:e.dialog.edit.form.project_days,callback:function(t){e.$set(e.dialog.edit.form,"project_days",t)},expression:"dialog.edit.form.project_days"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"开始时间",prop:"project_startdate"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.project_startdate))]):a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"开始日期"},model:{value:e.dialog.edit.form.project_startdate,callback:function(t){e.$set(e.dialog.edit.form,"project_startdate",t)},expression:"dialog.edit.form.project_startdate"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"结束时间",prop:"project_enddate"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.project_enddate))]):a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"开始日期"},model:{value:e.dialog.edit.form.project_enddate,callback:function(t){e.$set(e.dialog.edit.form,"project_enddate",t)},expression:"dialog.edit.form.project_enddate"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("el-link",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(a){return e.handleEditBtn(t)}}},[e._v("编辑")]):e._e(),e._v(" "),t.$index===e.dialog.edit.index?a("el-link",{attrs:{type:"success",icon:"el-icon-check"},on:{click:function(t){return e.handleEditSubmit()}}},[e._v("保存")]):e._e(),e._v(" "),t.$index===e.dialog.edit.index?a("el-link",{attrs:{type:"warning",icon:"el-icon-close"},on:{click:function(t){return e.handleEditCancel()}}},[e._v("取消编辑")]):e._e(),e._v(" "),a("el-link",{attrs:{icon:"el-icon-delete",type:"danger"},on:{click:function(a){return e.handleDelete(t.row.dis_id)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)},i=[],l=(a("ac67"),a("1bc7"),a("32ea"),a("28f8")),d=a("6797"),n=a("24d2"),c=a("b199"),s=a("18ed"),p=a("857b"),u=a("3641");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m=(o={components:{}},Object(l["a"])(o,"components",{SelectYear:s["a"],Pagination:u["a"]}),Object(l["a"])(o,"data",(function(){return{searchData:{project_year:"",project_state:""},table:{data:[],distributeData:[]},page:{current:1,total:0},ssgcOptions:[],dialog:{add:{visible:!1,form:{project_days:"",project_enddate:"",project_id:"",project_oper:"",project_rate:"",project_startdate:""}},edit:{index:null,form:{}}},personOptions:[]}})),Object(l["a"])(o,"mounted",(function(){this.getPersons()})),Object(l["a"])(o,"methods",{getTableData:function(){var e=this;n["c"].selectdept().then((function(t){200==t.code?(e.table.data=t.data.list,e.page.total=t.data.total):e.table.data=[]}))},getProjectState:function(){var e=this;d["c"].getProjectState().then((function(t){e.ssgcOptions=t}))},getDistributeData:function(e){var t=this;n["b"].select(e).then((function(e){t.$set(t.table,"distributeData",e.data)}))},handleQuery:function(){var e=this;n["c"].selectdept({project_year:this.searchData.project_year,project_state:this.searchData.project_state}).then((function(t){200==t.code?(e.table.data=t.data.list,e.page.total=t.data.total):e.table.data=[]}))},openDialog:function(e,t){this.dialog.add={visible:!0,type:e,form:Object.assign({},t)||{}},this.getProjectState(),this.getDistributeData({project_id:e.project_id})},closeDialog:function(){this.dialog.add.visible=!1,this.dialogEditData(null,{})},handleEditBtn:function(e){this.dialogEditData(e.$index,e.row)},handleEditCancel:function(){this.dialogEditData(null,{})},handleEditSubmit:function(){var e=this;n["b"].update(this.dialog.edit.form).then((function(t){Object(p["i"])(e,t),e.dialogEditData(null,{}),e.getDistributeData({project_id:e.dialog.add.type.project_id})}))},dialogEditData:function(e,t){this.dialog.edit={index:e,form:JSON.parse(JSON.stringify(t))}},handleDelete:function(e){var t=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n["b"].deletebyid({dis_id:e}).then((function(e){Object(p["i"])(t,e),t.getDistributeData({project_id:t.dialog.add.type.project_id})}))})).catch((function(){}))},handleDistributionAdd:function(){var e=this;if(!Object(p["j"])(this,"addForm"))return!1;if(new Date(this.dialog.add.form.project_startdate).getTime()>new Date(this.dialog.add.form.project_enddate).getTime())return this.$message.error("开始时间不能大于结束时间！"),!1;var t=_(_({},{project_id:this.dialog.add.type.project_id}),this.dialog.add.form);n["b"].add(t).then((function(t){Object(p["i"])(e,t),e.getDistributeData({project_id:e.dialog.add.type.project_id})}))},handleChangeYear:function(e){this.searchData.project_year=e},handleCurrentChange:function(){var e=this;n["c"].selectdept({page_number:this.page.current}).then((function(t){e.table.data=t.data.list}))},getPersons:function(){var e=this;c["h"].selectdeptuser().then((function(t){e.personOptions=t.data}))}}),o),b=m,g=a("5d22"),h=Object(g["a"])(b,r,i,!1,null,null,null);t["default"]=h.exports}}]);