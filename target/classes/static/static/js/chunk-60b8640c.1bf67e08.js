(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60b8640c"],{"1ab4":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{staticStyle:{"margin-top":"30px"},attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("el-card",{staticClass:"tree-card",attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("项目类型")]),e._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.handleAddProjectName}},[e._v("新增类型")])],1),e._v(" "),a("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[a("el-tree",{attrs:{data:e.tree.data,props:e.tree.props,"allow-drag":e.allowDrag,"allow-drop":e.allowDrop,"node-key":"id",draggable:"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,r=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{on:{click:function(t){return e.handleNodeClick(o,r)}}},[e._v(e._s(o.label))]),e._v(" "),a("span",{staticClass:"custom-tree-handle"},["分类"===r.type?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.addproject(o,r)}}},[e._v("添加")]):e._e(),e._v(" "),"分类"===r.type?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.openProjectDialog(r,2)}}},[e._v("修改")]):e._e(),e._v(" "),"分类"===r.type?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.handleRemoveTree(o,r)}}},[e._v("删除")]):e._e()],1)])}}])})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-form",{attrs:{inline:"",model:e.searchForm,size:"small"}},[a("el-row",[a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"项目名称"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入项目名称"},model:{value:e.searchForm.project_name,callback:function(t){e.$set(e.searchForm,"project_name",t)},expression:"searchForm.project_name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"项目年份"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.project_year,callback:function(t){e.$set(e.searchForm,"project_year",t)},expression:"searchForm.project_year"}},e._l(e.yearList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"项目状态"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.schedule_status,callback:function(t){e.$set(e.searchForm,"schedule_status",t)},expression:"searchForm.schedule_status"}},e._l(e.getKyProjectStateList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"项目周期"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.searchForm.project_cycle,callback:function(t){e.$set(e.searchForm,"project_cycle",t)},expression:"searchForm.project_cycle"}},e._l(e.getKyProjectCycle,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleQuery}},[e._v("搜索")])],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{label:"项目名称",prop:"project_name",width:"120",fixed:""}}),e._v(" "),a("el-table-column",{attrs:{label:"项目状态",prop:"project_state",width:"120",fixed:""}}),e._v(" "),a("el-table-column",{attrs:{label:"项目年份",prop:"project_year"}}),e._v(" "),a("el-table-column",{attrs:{label:"项目周期",prop:"project_cycle"}}),e._v(" "),a("el-table-column",{attrs:{label:"负责单位",prop:"project_unit",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"项目负责人",prop:"project_leader",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"技术带头人",prop:"technical_leader",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"项目成员",prop:"project_members",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{label:"开始时间",prop:"project_startdate",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"结束时间",prop:"project_enddate",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"总经费",prop:"total_money",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"已下经费",prop:"pay_money"}}),e._v(" "),a("el-table-column",{attrs:{label:"备注",prop:"remark",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"到账率",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s((Number(t.row.pay_money)/Number(t.row.total_money)*100).toFixed(3)+"%")+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"未下经费",prop:"not_money"}}),e._v(" "),a("el-table-column",{attrs:{label:"已下经费",prop:"have_funds"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"400",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.dialog.edit.index?a("el-link",{attrs:{disabled:e.notEditStatus.includes(t.row.project_state),type:"primary",icon:"el-icon-edit"},on:{click:function(a){return e.handleOpenDialog("edit",t)}}},[e._v("编辑")]):e._e(),e._v(" "),a("el-link",{attrs:{disabled:e.notEditStatus.includes(t.row.project_state),type:"danger",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("删除")]),e._v(" "),a("el-link",{attrs:{type:"warning",icon:"el-icon-bottom"},on:{click:function(a){return e.openStudioDialog(t.row)}}},[e._v("下达")]),e._v(" "),a("el-link",{attrs:{type:"info",icon:"el-icon-s-claim"},on:{click:function(a){return e.stributeDialogOpen(t.row)}}},[e._v("进度")]),e._v(" "),a("el-link",{attrs:{type:"success",icon:"el-icon-coin"},on:{click:function(a){return e.openFundsDialog(t.row)}}},[e._v("经费")]),e._v(" "),a("el-link",{attrs:{type:"primary",icon:"el-icon-document"},on:{click:function(a){return e.openDocumentLink(t.row.scientific_id)}}},[e._v("文档")])]}}])})],1),e._v(" "),a("pagination",{attrs:{"current-page":e.page.current,"page-size":10,total:e.page.total},on:{"page-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"进度",visible:e.stribute.visible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.stribute,"visible",t)}}},[a("div",{staticClass:"task-list-container"},[a("el-form",{ref:"bookruleForm",attrs:{model:e.addForm2,rules:e.bookFormRules}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"fl w30 wz30",attrs:{label:"作业过程","label-width":"80px",prop:"project_rate"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.addForm2.project_rate,callback:function(t){e.$set(e.addForm2,"project_rate",t)},expression:"addForm2.project_rate"}},e._l(e.dutyBookOptinos,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"fl w30 wz30",attrs:{label:"人员","label-width":"80px",prop:"project_oper"}},[a("el-select",{ref:"userBookSelect",attrs:{size:"small",placeholder:"请选择"},model:{value:e.addForm2.project_oper,callback:function(t){e.$set(e.addForm2,"project_oper",t)},expression:"addForm2.project_oper"}},e._l(e.userOptions,(function(e){return a("el-option",{key:e.user_id,attrs:{label:e.user_name,value:e.user_id}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"fl w30 wz30 input-number",attrs:{label:"工天","label-width":"80px",prop:"project_days"}},[a("el-input",{attrs:{type:"number"},model:{value:e.addForm2.project_days,callback:function(t){e.$set(e.addForm2,"project_days",t)},expression:"addForm2.project_days"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"dateTimeWidth",attrs:{label:"开始时间","label-width":"80px",prop:"project_startdate"}},[a("el-date-picker",{staticClass:"mapDatePicker",attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.addForm2.project_startdate,callback:function(t){e.$set(e.addForm2,"project_startdate",t)},expression:"addForm2.project_startdate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"dateTimeWidth",attrs:{label:"结束时间","label-width":"80px",prop:"project_enddate"}},[a("el-date-picker",{staticClass:"mapDatePicker",attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.addForm2.project_enddate,callback:function(t){e.$set(e.addForm2,"project_enddate",t)},expression:"addForm2.project_enddate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"fl w30",attrs:{label:"","label-width":"30px"}},[a("span",{staticClass:"pointer c-blue",on:{click:e.addBookDistribute}},[a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"font-size":"20px",color:"#189fff"}})])])],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.stribute.data}},[a("el-table-column",{attrs:{label:"过程",prop:"project_rate"}}),e._v(" "),a("el-table-column",{attrs:{label:"人员",prop:"project_oper"}}),e._v(" "),a("el-table-column",{attrs:{label:"工天",prop:"project_days"}}),e._v(" "),a("el-table-column",{attrs:{label:"开始时间",prop:"project_enddate"}}),e._v(" "),a("el-table-column",{attrs:{label:"结束时间",prop:"project_startdate"}}),e._v(" "),a("el-table-column",{attrs:{label:"结束时间",prop:"project_startdate"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleProgressDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:this.addDialog.title,visible:e.addDialog.visible,width:"700px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.addDialog,"visible",t)}}},[a("div",{staticClass:"task-list-container"},[a("el-form",{ref:"addProjectDialog",attrs:{inline:"",model:e.addDialog.form,size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"formLabelWidth projectRow",attrs:{label:"项目年份",prop:"project_year",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"projectInput",model:{value:e.addDialog.form.project_year,callback:function(t){e.$set(e.addDialog.form,"project_year",t)},expression:"addDialog.form.project_year"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"项目名称",prop:"project_name",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"projectInput",model:{value:e.addDialog.form.project_name,callback:function(t){e.$set(e.addDialog.form,"project_name",t)},expression:"addDialog.form.project_name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"项目来源",prop:"project_source",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"projectInput",model:{value:e.addDialog.form.project_source,callback:function(t){e.$set(e.addDialog.form,"project_source",t)},expression:"addDialog.form.project_source"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"项目周期",prop:"project_cycle",rules:[{required:!0,message:"不能空"}]}},[a("el-select",{staticClass:"projectInput",attrs:{placeholder:"请选择",clearable:""},model:{value:e.addDialog.form.project_cycle,callback:function(t){e.$set(e.addDialog.form,"project_cycle",t)},expression:"addDialog.form.project_cycle"}},e._l(e.getKyProjectCycle,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"负责单位",prop:"project_unit",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"projectInput",model:{value:e.addDialog.form.project_unit,callback:function(t){e.$set(e.addDialog.form,"project_unit",t)},expression:"addDialog.form.project_unit"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"formLabelWidth projectRow",attrs:{label:"项目状态",prop:"project_state",rules:[{required:!0,message:"不能空"}]}},[a("el-select",{staticClass:"projectInput",attrs:{placeholder:"请选择",clearable:""},model:{value:e.addDialog.form.project_state,callback:function(t){e.$set(e.addDialog.form,"project_state",t)},expression:"addDialog.form.project_state"}},e._l(e.getKyProjectStateList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"项目负责人",prop:"project_leader",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"project12",model:{value:e.addDialog.form.project_leader,callback:function(t){e.$set(e.addDialog.form,"project_leader",t)},expression:"addDialog.form.project_leader"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"技术带头人",prop:"technical_leader",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"project12",model:{value:e.addDialog.form.technical_leader,callback:function(t){e.$set(e.addDialog.form,"technical_leader",t)},expression:"addDialog.form.technical_leader"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"projectRow",staticStyle:{width:"100%"},attrs:{label:"项目成员",prop:"project_members",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"projectInput",model:{value:e.addDialog.form.project_members,callback:function(t){e.$set(e.addDialog.form,"project_members",t)},expression:"addDialog.form.project_members"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"开始时间",prop:"project_startdate",rules:[{required:!0,message:"不能空"}]}},[a("el-date-picker",{staticClass:"project12",staticStyle:{width:"140px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"开始时间"},model:{value:e.addDialog.form.project_startdate,callback:function(t){e.$set(e.addDialog.form,"project_startdate",t)},expression:"addDialog.form.project_startdate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"结束时间",prop:"project_enddate",rules:[{required:!0,message:"不能空"}]}},[a("el-date-picker",{staticClass:"project12",staticStyle:{width:"140px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"开始时间"},model:{value:e.addDialog.form.project_enddate,callback:function(t){e.$set(e.addDialog.form,"project_enddate",t)},expression:"addDialog.form.project_enddate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"总经费",prop:"total_money",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"project12",attrs:{placeholder:""},nativeOn:{keyup:function(t){e.addDialog.form.total_money=e.oninput(e.addDialog.form.total_money)}},model:{value:e.addDialog.form.total_money,callback:function(t){e.$set(e.addDialog.form,"total_money",t)},expression:"addDialog.form.total_money"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"已下经费",prop:"pay_money",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{staticClass:"project12",attrs:{placeholder:""},nativeOn:{keyup:function(t){e.addDialog.form.pay_money=e.oninput(e.addDialog.form.pay_money)}},model:{value:e.addDialog.form.pay_money,callback:function(t){e.$set(e.addDialog.form,"pay_money",t)},expression:"addDialog.form.pay_money"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"projectRow",attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"projectInput",attrs:{type:"textarea"},model:{value:e.addDialog.form.remark,callback:function(t){e.$set(e.addDialog.form,"remark",t)},expression:"addDialog.form.remark"}})],1)],1)],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitAddDialog("addProjectDialog")}}},[e._v("确定")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"下达",visible:e.StudioData.visible,width:"300px"},on:{"update:visible":function(t){return e.$set(e.StudioData,"visible",t)}}},[a("el-form",{attrs:{model:e.StudioData.form}},[a("el-form-item",{attrs:{label:"作业室"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择作业室"},model:{value:e.StudioData.form.selected,callback:function(t){e.$set(e.StudioData.form,"selected",t)},expression:"StudioData.form.selected"}},e._l(e.StudioData.option,(function(e){return a("el-option",{key:e.label,attrs:{label:e.prop,value:e.label}})})),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeStudioDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitStudioDialog}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.subjectDialog.title,visible:e.subjectDialog.visible,width:"300px"},on:{"update:visible":function(t){return e.$set(e.subjectDialog,"visible",t)}}},[a("el-input",{attrs:{placeholder:"请输入科研项目"},model:{value:e.subjectDialog.form.subject_name,callback:function(t){e.$set(e.subjectDialog.form,"subject_name",t)},expression:"subjectDialog.form.subject_name"}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.subjectDialog.visible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitSubjectDialog}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"经费使用管理",visible:e.fundsDialog.add.visible,width:"1200px"},on:{"update:visible":function(t){return e.$set(e.fundsDialog.add,"visible",t)}}},[a("el-form",{ref:"addFundsForm",staticClass:"search-form",attrs:{inline:"",model:e.fundsDialog.add.form,size:"small","label-width":"80px"}},[a("el-form-item",{attrs:{label:"科目",prop:"subject_name",rules:[{required:!0,message:"不能空"}]}},[a("el-input",{model:{value:e.fundsDialog.add.form.subject_name,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_name",t)},expression:"fundsDialog.add.form.subject_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"预算金额",prop:"subject_budget"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.fundsDialog.add.form.subject_budget,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_budget",t)},expression:"fundsDialog.add.form.subject_budget"}},[a("template",{slot:"append"},[e._v("万元")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"标准",prop:"subject_standard"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.fundsDialog.add.form.subject_standard,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_standard",t)},expression:"fundsDialog.add.form.subject_standard"}},[a("template",{slot:"append"},[e._v("万元")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"数量",prop:"subject_count"}},[a("el-input",{attrs:{clearable:"",type:"number",step:"0.01",min:"0",onkeyup:"this.value= this.value.match(/\\d+(\\.\\d{0,2})?/) ? this.value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''"},model:{value:e.fundsDialog.add.form.subject_count,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_count",t)},expression:"fundsDialog.add.form.subject_count"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"到账金额",prop:"subject_received"}},[a("el-input",{attrs:{type:"number"},model:{value:e.fundsDialog.add.form.subject_received,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_received",t)},expression:"fundsDialog.add.form.subject_received"}},[a("template",{slot:"append"},[e._v("万元")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"支出金额",prop:"subject_pay"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.fundsDialog.add.form.subject_pay,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_pay",t)},expression:"fundsDialog.add.form.subject_pay"}},[a("template",{slot:"append"},[e._v("万元")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"剩余金额",prop:"subject_balance"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.fundsDialog.add.form.subject_balance,callback:function(t){e.$set(e.fundsDialog.add.form,"subject_balance",t)},expression:"fundsDialog.add.form.subject_balance"}},[a("template",{slot:"append"},[e._v("万元")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:" "}},[a("el-button",{attrs:{type:"primary"},on:{click:e.fundsHandleDistributionAdd}},[e._v("添加")])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.subjectPayData}},[a("el-table-column",{attrs:{label:"科目",prop:"subject_name",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.fundsDialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.subject_name))]):a("el-input",{model:{value:e.fundsDialog.edit.form.subject_name,callback:function(t){e.$set(e.fundsDialog.edit.form,"subject_name",t)},expression:"fundsDialog.edit.form.subject_name"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"预算金额",prop:"subject_budget",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.fundsDialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.subject_budget))]):a("el-input",{model:{value:e.fundsDialog.edit.form.subject_budget,callback:function(t){e.$set(e.fundsDialog.edit.form,"subject_budget",t)},expression:"fundsDialog.edit.form.subject_budget"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"到账金额",prop:"subject_received",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.fundsDialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.subject_received))]):a("el-input",{model:{value:e.fundsDialog.edit.form.subject_received,callback:function(t){e.$set(e.fundsDialog.edit.form,"subject_received",t)},expression:"fundsDialog.edit.form.subject_received"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"支出金额",prop:"subject_pay"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.fundsDialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.subject_pay))]):a("el-input",{model:{value:e.fundsDialog.edit.form.subject_pay,callback:function(t){e.$set(e.fundsDialog.edit.form,"subject_pay",t)},expression:"fundsDialog.edit.form.subject_pay"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"剩余金额",prop:"subject_balance"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.fundsDialog.edit.index?a("div",{attrs:{icon:"el-icon-edit"}},[e._v(e._s(t.row.subject_balance))]):a("el-input",{model:{value:e.fundsDialog.edit.form.subject_balance,callback:function(t){e.$set(e.fundsDialog.edit.form,"subject_balance",t)},expression:"fundsDialog.edit.form.subject_balance"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index!==e.fundsDialog.edit.index?a("el-link",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(a){return e.fundsHandleEditBtn(t)}}},[e._v("编辑")]):e._e(),e._v(" "),t.$index===e.fundsDialog.edit.index?a("el-link",{attrs:{type:"success",icon:"el-icon-check"},on:{click:function(t){return e.fundsHandleEditSubmit()}}},[e._v("保存")]):e._e(),e._v(" "),t.$index===e.fundsDialog.edit.index?a("el-link",{attrs:{type:"warning",icon:"el-icon-close"},on:{click:function(t){return e.fundsHandleEditCancel()}}},[e._v("取消编辑")]):e._e(),e._v(" "),a("el-link",{attrs:{icon:"el-icon-delete",type:"danger"},on:{click:function(a){return e.fundsHandleDelete(t.row.subject_id)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.projectDialogTitle,visible:e.projectDialog.visible,width:"300px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.projectDialog,"visible",t)}}},[a("el-form",{ref:"addProjectType",attrs:{model:e.projectDialog.form,size:"small"}},[a("el-form-item",{attrs:{label:"项目名称"}},[a("el-input",{staticStyle:{width:"150px"},model:{value:e.projectDialog.form.name,callback:function(t){e.$set(e.projectDialog.form,"name",t)},expression:"projectDialog.form.name"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closeProjectDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitProjectDialog("addProjectType")}}},[e._v("确 定")])],1)],1)],1)},r=[],l=(a("ac67"),a("1bc7"),a("32ea"),a("a7e5"),a("28f8")),i=(a("8dee"),a("24d2")),s=a("857b"),n=a("18ed"),c=a("3641"),d=a("6797");a("fddc"),a("b199");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={components:{SelectYear:n["a"],Pagination:c["a"]},data:function(){return{searchForm:{project_year:"",project_name:"",project_cycle:"",schedule_status:""},interfaceType:"",yearList:[],getKyProjectStateList:[],getKyProjectCycle:[],deptIdArrData:"",options:{projectList:[]},notEditStatus:["已完成","已下达","正在处理"],scienceData:[],StudioData:{visible:!1,row:{},option:[],form:{}},stribute:{visible:!1,data:[]},page:{current:1,total:1},daterangeValue:"",dialog:{title:"新增科研项目",type:"add",visible:!1,add:{form:{subject_name:"",subject_balance:"",subject_budget:"",subject_count:"",subject_pay:"",subject_received:"",subject_standard:""}},edit:{form:{}}},addDialog:{visible:!1,projectId:"",projectIndexId:"",title:"添加项目",form:{id:"",index_id:"",pay_money:"",total_money:"",project_cycle:"",project_enddate:"",project_leader:"",project_members:"",project_name:"",project_source:"",project_startdate:"",project_state:"",project_unit:"",project_year:"2020",remark:"",technical_leader:""}},fundsDialog:{add:{visible:!1,type:{},form:{project_days:"",project_enddate:"",project_id:"",project_oper:"",project_rate:"",project_startdate:""}},edit:{index:null,form:{}}},subjectDialog:{visible:!1,title:"添加科研项目",form:{}},subjectList:[],subjectPayData:[],tableData:[],tableLoading:!1,tree:{data:[],props:{label:"label"}},currentProjectId:null,currentProjectType:null,projectDialog:{type:1,visible:!1,form:{name:""},data:{}},rules:{},addForm2:{project_rate:"",project_oper:"",project_days:"",project_startdate:"",project_enddate:""},bookFormRules:{project_rate:[{required:!0,message:"请选择作业过程",trigger:"blur"}],project_oper:[{required:!0,message:"请选择人员",trigger:"blur"}],project_days:[{required:!0,message:"请输入工天",trigger:"blur"}],project_startdate:[{required:!0,message:"请选择开始时间",trigger:"blur"}],project_enddate:[{required:!0,message:"请选择结束时间",trigger:"blur"}]},dutyBookOptinos:["组长","编辑设计","作业","校对"],userOptions:[],project_id:""}},computed:{projectDialogTitle:function(){return(1===this.projectDialog.type?"添加":"修改")+"类型"},addDialogBookValue:function(){var e=parseFloat(this.dialog.add.form.have_funds)||0,t=parseFloat(this.dialog.add.form.not_money)||0;return e?(console.log((e/(t+e)).toFixed(4)),100*(e/(t+e)).toFixed(4)+"%"):"0%"}},mounted:function(){this.getTree(),this.getTableData(),this.getWorkSelect(),this.getListdata()},methods:{oninput:function(e){var t=e,a=t.substr(0,1),o=t.substr(1,1);if(t.length>1&&0==a&&"."!=o&&(t=t.substr(1,1)),"."==a&&(t=""),-1!=t.indexOf(".")){var r=t.substr(t.indexOf(".")+1);-1!=r.indexOf(".")&&(t=t.substr(0,t.indexOf(".")+r.indexOf(".")+1))}return t=t.replace(/[^\d^\.]+/g,""),t=t.replace(/\.\d\d\d$/,""),t},messageInfo:function(e){this.$message({message:e.message,type:"warning"})},resetAddDialogForm:function(){this.addDialog.form={pay_money:"",total_money:"",project_cycle:"",project_enddate:"",project_leader:"",project_members:"",project_name:"",project_source:"",project_startdate:"",project_state:"",project_unit:"",project_year:"2020",remark:"",technical_leader:""}},submitAddDialog:function(e){var t=this;this.$refs[e].validate((function(e){if(console.log("2"),!e)return console.log("error submit!!"),!1;console.log("1");var a=p({},t.addDialog.form);a.id="",a.index_id=t.addDialog.projectId,i["c"].addProject(a).then((function(e){200==e.code?(t.addDialog.visible=!1,t.addDialog.form={},t.resetAddDialogForm(),t.getTableData(),t.getTree()):t.messageInfo(e)}))}))},getListdata:function(){this.getKyProjectYear(),this.getKyProjectState(),this.gethandleKyProjectCycle()},getKyProjectYear:function(){var e=this;i["c"].getKyProjectYear().then((function(t){t.length>0?e.yearList=t:e.message({message:"数据为空！",type:"warning"})}))},getKyProjectState:function(){var e=this;i["c"].getKyProjectState().then((function(t){t.length>0?e.getKyProjectStateList=t:e.message({message:"数据为空！",type:"warning"})}))},gethandleKyProjectCycle:function(){var e=this;i["c"].getKyProjectCycle().then((function(t){t.length>0?e.getKyProjectCycle=t:e.message({message:"数据为空！",type:"warning"})}))},handleProgressDelete:function(e){var t=this;console.log(e),d["b"].deleteById({dis_id:e.dis_id}).then((function(e){200==e.code?(t.$message({message:e.message,type:"success"}),t.getJinDuTableList()):t.$message({message:e.message,type:"warning"})}))},addBookDistribute:function(){var e=this;this.$refs["bookruleForm"].validate((function(t){if(!t)return e.$message({message:"请将表单填写完整！",type:"warning"}),!1;if(new Date(e.addForm2.project_startdate).getTime()>new Date(e.addForm2.project_enddate).getTime())e.$message.error("开始时间不能大于结束时间！");else{for(var a,o=e.addForm2,r=o.project_rate,l=o.project_oper,i=o.project_days,s=o.project_startdate,n=o.project_enddate,c=0;c<e.userOptions.length;c++)e.userOptions[c].user_id===l&&(a=e.userOptions[c].user_name);var u={dept_id:String(e.deptIdArrData),dis_id:e.project_id,project_id:e.project_id,project_rate:r,project_oper:a,project_days:i,project_startdate:s,project_enddate:n,remark:"",user_id:l};d["b"].addAssignPersonnelInformation(u).then((function(t){200==t.code?(e.getJinDuTableList(),e.restAddfromItem()):(e.$message({message:t.message,type:"warning"}),e.restAddfromItem())}))}}))},getTree:function(){var e,t=this;i["c"].getProjectIndexList({project_year:e}).then((function(e){200==e.code?t.tree.data=e.data:t.$message({message:e.message,type:"warning"})}))},handleQuery:function(){this.interfaceType="搜索",this.currentProjectId=null,this.getTableData()},handleNodeClick:function(e,t){this.interfaceType="tree节点","0"!==t.pid&&(this.currentProjectId=t.id,this.currentProjectType=t.type,this.getTableData())},handleAddProjectName:function(){this.openProjectDialog({id:0},1)},addproject:function(e,t){this.addDialog.title="添加项目",this.addDialog.visible=!0,this.addDialog.projectId=t.id,this.addDialog.projectIndexId=t.pid,this.resetAddDialogForm(),Object(s["g"])(this,"addProjectDialog")},openProjectDialog:function(e,t){console.log(e),this.projectDialog.visible=!0,e=Object.assign({},e),this.projectDialog.data=e,this.projectDialog.type=t,this.projectDialog.form.name=1!=t?e.label:""},closeProjectDialog:function(){this.projectDialog.visible=!1},submitProjectDialog:function(e){var t=this;console.log(this.$refs[e]),this.$refs[e].validate((function(e){if(!e)return!1;var a=null;a=1===t.projectDialog.type?t.handleAppendTree():t.handleEditTree(),a.then((function(e){t.getTree(),t.getTableData(),t.closeProjectDialog(),Object(s["i"])(t,e)}))}))},handleAppendTree:function(e){var t=p({},this.projectDialog.form);return i["c"].addProjectIndex(t)},handleEditTree:function(e){console.log(e);var t=p(p({},this.projectDialog.form),{},{id:this.projectDialog.data.id});return i["c"].updateScientificById(t)},handleRemoveTree:function(e,t){var a=this;"0"===t.parent_id?this.$message.warning("根节点不能删除!"):this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i["c"].deleteProjectIndex({id:t.id,nodeType:t.type}).then((function(o){Object(s["i"])(a,o);var r=e.parent,l=r.data.children||r.data,i=l.findIndex((function(e){return e.id===t.id}));l.splice(i,1)}))})).catch((function(){}))},getTableData:function(){var e,t=this;this.tableLoading=!0,"tree节点"==this.interfaceType?(e={page_number:this.page.current,page_size:10,node_id:this.currentProjectId,node_type:this.currentProjectType,project_year:this.searchForm.project_year},i["c"].getProjectList(e).then((function(e){t.tableLoading=!1,200===e.code&&e.data.list.length>0?(t.tableData=e.data.list,t.page.total=e.data.recordCount):t.tableData=[]}))):(e=p({},this.searchForm),e.page_number=this.page.current,e.page_size=10,i["c"].getProjectByDefine(e).then((function(e){t.tableLoading=!1,200===e.code&&e.data.list.length>0?(t.tableData=e.data.list,t.page.total=e.data.recordCount):t.tableData=[]})))},handleOpenDialog:function(e,t){console.log(t.row),this.dialog.type=e,"add"===e?(this.addDialog.title="添加项目",this.addDialog.form={}):(this.addDialog.visible=!0,this.addDialog.title="编辑项目",this.addDialog.form=JSON.parse(JSON.stringify(t.row)))},submitAddForm:function(){var e=this;return!!Object(s["j"])(this,"addForm")&&(new Date(this.dialog.add.form.project_startdate).getTime()>new Date(this.dialog.add.form.schedule_time).getTime()?(this.$message.error("开始时间不能大于进度时间！"),!1):(this.dialog.add.form.book_value=this.addDialogBookValue,void("add"===this.dialog.type?i["c"].add(this.dialog.add.form).then((function(t){Object(s["i"])(e,t),e.dialog.visible=!1,e.getTableData()})):i["c"].updataScientificById(this.dialog.add.form).then((function(t){Object(s["i"])(e,t),e.dialog.visible=!1,e.getTableData()})))))},handleDelete:function(e){var t=this;console.log(e),this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i["c"].deleteProjectIndex({id:e,nodeType:"项目"}).then((function(e){200==e.code?(Object(s["i"])(t,e),t.getTableData(),t.getTree()):t.messageInfo(e)}))})).catch((function(){}))},viewThis:function(e){this.dialogVisible=!0},handleChangeDialogYear:function(e){this.dialog.add.form.year=e},handleCurrentChange:function(e){var t=this;this.page.current=e;var a={dept_id:this.currentProjectId,page_number:e,page_size:10};handleApi.getScientific(a).then((function(e){200===e.code&&(t.page.total=e.data.recordCount,t.tableData=e.data.list)})).catch((function(e){console.log(e)}))},restAddfromItem:function(){this.addForm2.project_rate="",this.addForm2.project_oper="",this.addForm2.project_days="",this.addForm2.project_startdate="",this.addForm2.project_enddate=""},getStudioData:function(){var e=this;d["b"].getAllZuoyeshiList().then((function(t){e.StudioData.option=t.data}))},openStudioDialog:function(e){this.getStudioData(),this.StudioData.visible=!0,this.StudioData.row=e},closeStudioDialog:function(){this.StudioData.visible=!1,this.StudioData.row={}},submitStudioDialog:function(){for(var e=this,t=this.StudioData.form.selected.length,a=[],o=0;o<t;o++)a.push({dept_id:this.StudioData.form.selected[o],project_id:this.StudioData.row.scientific_id});i["a"].add(a).then((function(t){Object(s["i"])(e,t),e.StudioData.visible=!1}))},getJinDuTableList:function(){var e=this;i["b"].select({project_id:this.project_id}).then((function(t){e.stribute.visible=!0,e.stribute.data=t.data}))},stributeDialogOpen:function(e){var t=this;this.project_id=e.scientific_id,this.getPeopleSelect(),d["b"].isDistributionDepartment({project_id:e.scientific_id}).then((function(e){if(200==e.code){var a=e.data.replace("[","");t.deptIdArrData=a.replace("]",""),console.log(t.deptIdArrData),t.getJinDuTableList()}else t.messageInfo(e)}))},openFundsDialog:function(e){this.fundsDialog.add={visible:!0,type:e,form:{}},this.getProjectSubject(e.scientific_id),this.getSubjectPay(e.scientific_id)},getProjectSubject:function(e){var t=this;i["d"].select({project_id:e}).then((function(e){t.subjectPayData=e.data}))},openAddSubjectDialog:function(e){this.subjectDialog.type=e,this.subjectDialog.visible=!0,"add"===e?(this.subjectDialog.title="添加科研项目",this.subjectDialog.form={}):this.subjectDialog.title="编辑科研项目"},submitSubjectDialog:function(){var e=this,t=p(p({},this.subjectDialog.form),{},{project_id:this.fundsDialog.add.type.project_id});"add"===this.subjectDialog.type&&i["d"].add(t).then((function(t){Object(s["i"])(e,t),e.subjectDialog.form={},e.getProjectSubject(e.fundsDialog.add.type.project_id),e.subjectDialog.visible=!1}))},getSubjectPay:function(e){},fundsHandleEditBtn:function(e){this.fundsDialogEditData(e.$index,e.row)},fundsHandleEditCancel:function(){this.fundsDialogEditData(null,{})},fundsHandleEditSubmit:function(){var e=this;i["d"].update(this.fundsDialog.edit.form).then((function(t){Object(s["i"])(e,t),e.fundsDialogEditData(null,{}),e.getProjectSubject(e.fundsDialog.add.type.project_id)}))},fundsDialogEditData:function(e,t){this.fundsDialog.edit={index:e,form:JSON.parse(JSON.stringify(t))}},fundsHandleDelete:function(e){var t=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i["d"].deletebyid({subject_id:e}).then((function(e){Object(s["i"])(t,e),t.getProjectSubject(t.fundsDialog.add.type.project_id)}))})).catch((function(){}))},fundsHandleDistributionAdd:function(){var e=this,t=p(p({},{project_id:this.fundsDialog.add.type.project_id}),this.fundsDialog.add.form);i["d"].add(t).then((function(t){Object(s["i"])(e,t),e.getProjectSubject(e.fundsDialog.add.type.project_id)}))},openDocumentLink:function(e){this.$router.push({path:"/science-staff/file",query:{id:e}})},getPeopleSelect:function(){var e=this;d["b"].getListOfPeople({project_id:this.project_id}).then((function(t){200===t.code?(e.userOptions=t.data,console.log(e.userOptions)):e.$message({message:t.message,type:"warning"})}))},getWorkSelect:function(){var e=this;d["b"].getChartTaskType().then((function(t){e.dutyBookOptinos=t}))},allowDrop:function(){},allowDrag:function(){}}},f=m,b=(a("d2e1"),a("5d22")),_=Object(b["a"])(f,o,r,!1,null,"7030f0f9",null);t["default"]=_.exports},a26d:function(e,t,a){},d2e1:function(e,t,a){"use strict";a("a26d")}}]);