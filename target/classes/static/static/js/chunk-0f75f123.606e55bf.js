(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f75f123"],{"5a7e":function(t,e,a){"use strict";a("c358")},"5be4":function(t,e,a){},"9d57":function(t,e,a){"use strict";a("f4d6")},ab9b:function(t,e,a){"use strict";a("5be4")},c358:function(t,e,a){},dc50:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"map-container",attrs:{"element-loading-text":"加载中"}},[a("ol-map",{ref:"olMap",attrs:{changeText:t.changeMapText,drawType:t.drawType},on:{"map-load":t.handleMapLoad,"get-vectorLayer":t.getVectorLayer}}),t._v(" "),a("left-btns",{ref:"leftBtns",attrs:{"upload-url":"/sys/data/addMapDataMany",typeCategory:t.drag.type,olmapVectorLayer:t.getOlmapVectorLayerData},on:{"submit-click":t.getMapDataByID,"submit-polygon":t.getAllDataByPolygon,"open-dialog":t.handleOpenDialog,export:t.handleExportAll,"clear-popover":t.handleClearPopover,"seamap-select-data":t.selectData,"show-topSearch-dialog":t.showTopSearchDialog,"change-kuang-xuan-text":t.changeKuangXuanText,"draw-type":t.handleDrawType}}),t._v(" "),a("right-panel",{ref:"rightPanel"},[a("right-search",{attrs:{"common-options":t.commonOptions},on:{query:t.handleQuery}})],1),t._v(" "),a("bottom-panel",{ref:"bottomPanel",attrs:{total:t.page.total},on:{change:t.handleCurrentChange,delete:t.hanldeBottomPanelDelete,export:t.hanldeBottomPanelExport}},[a("bottom-table",{ref:"bottomTable",attrs:{"search-data":t.search.data,olmapVectorLayer:t.getOlmapVectorLayerData},on:{delete:t.hanldeTableDelete,"select-row":t.handleGetFeature,"edit-table-row":t.handleEditTableRow,"delete-table-row":t.handleDeleteTableRow,"send-table-row":t.handleSendTableRow}})],1),t._v(" "),a("map-dialog",{ref:"mapDialog",attrs:{"common-options":t.commonOptions},on:{"submit-polygon":t.getMapDataByPolygon,"update-data":t.handleUpdateDragData,"get-newTableAndMap":t.getNewTableAndmap}}),t._v(" "),a("search-dialog",{attrs:{"common-options":t.commonOptions,showSearchDialog:t.showSearchDialog,treeNodes:t.treeNodesData},on:{"change-searchDialog":t.changeSearchDialog,"search-fromData":t.searchSeamapData}}),t._v(" "),a("drag-panel",{ref:"dragPanel",attrs:{"drag-type":t.drag.type,dataFile:t.drag.data},on:{close:t.handleCloseDrag,edit:t.handleEditMap,"update-seamap-bottomTable-rectangle":t.updateSeaMapBottomTableRectangle}},[a("popover",{ref:"popover",attrs:{data:t.drag.data}})],1)],1)},l=[],n=(a("ac67"),a("32ea"),a("d91d"),a("28f8")),r=(a("1bc7"),a("0c84"),a("6797")),s=a("0a39"),i=a("a98b"),p=a("44fe"),c=a("1732"),h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"search-container"},[a("el-col",{attrs:{span:22}},[a("el-form",{attrs:{model:t.searchData.form,"label-position":t.searchData.labelPosition,"label-width":t.searchData.formLabelWidth,size:"small"}},[a("el-form-item",{attrs:{label:"海图状态"}},[a("el-checkbox-group",{model:{value:t.searchData.form.map_state,callback:function(e){t.$set(t.searchData.form,"map_state",e)},expression:"searchData.form.map_state"}},t._l(t.commonOptions.mapState,(function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.value}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"海图类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择海图类型",clearable:""},on:{change:t.handleChangeMapType,clear:t.handleClearMapType},model:{value:t.searchData.form.map_type,callback:function(e){t.$set(t.searchData.form,"map_type",e)},expression:"searchData.form.map_type"}},t._l(t.commonOptions.mapType,(function(t){return a("el-option",{key:t.value,attrs:{label:t.value,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"海图图号"}},[a("el-input",{attrs:{width:"160px"},model:{value:t.searchData.form.map_code,callback:function(e){t.$set(t.searchData.form,"map_code",e)},expression:"searchData.form.map_code"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"中文名称"}},[a("el-input",{attrs:{width:"160px"},model:{value:t.searchData.form.map_cn_name,callback:function(e){t.$set(t.searchData.form,"map_cn_name",e)},expression:"searchData.form.map_cn_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"英文名称"}},[a("el-input",{attrs:{width:"160px"},model:{value:t.searchData.form.map_en_name,callback:function(e){t.$set(t.searchData.form,"map_en_name",e)},expression:"searchData.form.map_en_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"比例尺"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择比例尺",clearable:""},model:{value:t.searchData.form.map_scale,callback:function(e){t.$set(t.searchData.form,"map_scale",e)},expression:"searchData.form.map_scale"}},t._l(t.commonOptions.mapScale,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"出版日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"monthrange","range-separator":"至","start-placeholder":"起始时间","end-placeholder":"结束时间","value-format":"yyyyMM"},model:{value:t.searchData.form.publish_date,callback:function(e){t.$set(t.searchData.form,"publish_date",e)},expression:"searchData.form.publish_date"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{loading:t.searchData.loading,type:"primary"},on:{click:function(e){return t.handleQuery()}}},[t._v("查询")])],1)],1)],1)],1)},d=[],m=a("1c98"),u={mixins:[m["a"]],props:{commonOptions:{type:Object,default:function(){return{}}}},data:function(){return{pageFrom:"map",searchData:{form:{map_state:[],map_type:"",map_cn_name:"",map_en_name:"",map_scale:"",map_code:"",publish_unit:"",publish_date:""},formLabelWidth:"100px",labelPosition:"right",loading:!1},options:{}}},computed:{},methods:{handleChangeMapType:function(t){this.getMapScale(t,"search")},handleClearMapType:function(){this.commonOptions.mapScale=[]},handleQuery:function(){console.log(this.searchData.form);var t=this.handleMapData(this.searchData.form,"search");this.$emit("query",t)}}},f=u,b=a("5d22"),g=Object(b["a"])(f,h,d,!1,null,"07978b36",null),_=g.exports,w=a("9944"),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"table"},[a("el-col",{staticClass:"table-col",attrs:{span:24}},[a("el-table",{attrs:{data:t.tableData,"highlight-current-row":"",height:"100%",border:"",size:"small"},on:{"selection-change":t.handleSelectionChange,"row-click":t.handleRowClick}},[a("el-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_code",label:"图号",width:"100","show-overflow-tooltip":t.showOverflowTooltip,fixed:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_type",label:"海图类型",width:"150","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_cn_name",label:"中文图名",width:"200","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_en_name",label:"英文图名",width:"200","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_scale",label:"比例尺",width:"100","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_state",label:"资料状态",width:"150","show-overflow-tooltip":t.showOverflowTooltip},scopedSlots:t._u([{key:"default",fn:function(e){return["已出版"==e.row.map_state?a("span",{staticStyle:{color:"black"}},[t._v(t._s(e.row.map_state))]):"计划下达"==e.row.map_state?a("span",{staticStyle:{color:"cyan"}},[t._v(t._s(e.row.map_state))]):"正在作业中"==e.row.map_state?a("span",{staticStyle:{color:"DarkTurquoise"}},[t._v(t._s(e.row.map_state))]):"筹划"==e.row.map_state?a("span",{staticStyle:{color:"Orange"}},[t._v(t._s(e.row.map_state))]):"已作废"==e.row.map_state?a("span",{staticStyle:{color:"red"}},[t._v(t._s(e.row.map_state))]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"south_lat",label:"南图廓纬度",width:"150","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"north_lat",label:"北图廓纬度",width:"150","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"west_lon",label:"西图廓纬度",width:"150","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"east_lon",label:"东图廓纬度",width:"150","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_area",label:"地理区域",width:"100","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"map_amass",label:"图积",width:"120","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"publish_unit",label:"出版单位",width:"200"}}),t._v(" "),a("el-table-column",{attrs:{prop:"publish_date",label:"出版日期",width:"200"}}),t._v(" "),a("el-table-column",{attrs:{prop:"bc",label:"版次",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"sfgb",label:"是否改版",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"kcqk",label:"库存情况",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"tggzs",label:"通告改正数",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"xzlmjzb",label:"新资料面积占比",width:"140"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"200","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{prop:"source_state",label:"原始状态",width:"150","show-overflow-tooltip":t.showOverflowTooltip}}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.handleEditClick(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.handleDeleteClick(e.row)}}},[t._v("作废")]),t._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return t.handleSendData(e.row)}}},[t._v("发送")])]}}])})],1)],1)],1)},D=[],y=(a("a7e5"),a("dce5")),T=a("567e"),O=a("5f0b"),x=a("857b"),S={props:{searchData:{type:Object,default:function(){return{}}},olmapVectorLayer:{type:Object,default:function(){return{}}}},data:function(){return{showOverflowTooltip:!0,multipleSelection:[],tableData:[],tableCount:0}},computed:{multipleData:function(){return this.multipleSelection.map((function(t){return t.map_code})).join(",")}},mounted:function(){},methods:{handleSendData:function(t){this.$emit("send-table-row",t)},handleDeleteClick:function(t){this.$emit("delete-table-row",t)},handleEditClick:function(t){this.$emit("edit-table-row",t)},setData:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.tableData=t,this.tableCount=e},updateData:function(t){this.tableData=this.tableData.map((function(e){return e.map_id===t.map_id&&(e=t),e}))},handleSelectionChange:function(t,e){this.multipleSelection=t},handleRowClick:function(t){this.$emit("select-row",t);var e=new y["c"]({stroke:new T["a"]({color:"#1890ff",width:"1"}),fill:new O["a"]({color:"#1890ff"})}),a=this.olmapVectorLayer.getSource().getFeatureById(t.map_id),o=a.getStyle();this.flashChange(a,e,o)},flashChange:function(t,e,a){t.setStyle(e),t.changed(),window.setTimeout((function(){t.setStyle(a),t.changed()}),500)},handleCheckMultipleSelection:function(){return!(this.multipleSelection.length<=0)||(this.$message.error("没有选中"),!1)},handleCheckStateAllowDelete:function(){var t=this.multipleSelection.findIndex((function(t){return"已出版"!==t.map_state&&"筹划"!==t.map_state}));return!(t>-1)||(this.$message.error("资料已在任务中，不可作废！"),!1)},handleDelete:function(){var t=this;if(!this.handleCheckMultipleSelection())return!1;r["a"].zuofeiMap({mapCodes:this.multipleData}).then((function(e){Object(x["i"])(t,e),200===e.code&&t.$emit("delete")}))},handleExport:function(){if(!this.handleCheckMultipleSelection())return!1;r["a"].exportMapDataToExcel({mapCodeList:this.multipleData}).then((function(t){Object(x["c"])(t,"海图查询结果")}))}}},M=S,k=(a("5a7e"),Object(b["a"])(M,v,D,!1,null,"fd8d26d4",null)),P=k.exports,$=a("6c1d"),C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form",staticClass:"popover-form",attrs:{model:t.data,"label-width":"110px",size:"mini"}},[a("el-form-item",{attrs:{prop:"map_code",label:"海图图号",width:"100"}},[a("span",[t._v(t._s(t.data.map_code))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_type",label:"海图类型",width:"150"}},[a("span",[t._v(t._s(t.data.map_type))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_state",label:"海图状态",width:"150"}},[a("span",[t._v(t._s(t.data.map_state))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_cn_name",label:"中文名称",width:"200"}},[a("span",[t._v(t._s(t.data.map_cn_name))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_en_name",label:"英文名称",width:"200"}},[a("span",[t._v(t._s(t.data.map_en_name))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_scale",label:"比例尺",width:"100"}},[a("span",[t._v(t._s(t.data.map_scale))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_area",label:"海图区域",width:"100"}},[a("span",[t._v(t._s(t.data.map_area))])]),t._v(" "),a("el-form-item",{attrs:{prop:"map_amass",label:"海图图积",width:"120"}},[a("span",[t._v(t._s(t.data.map_amass))])]),t._v(" "),a("el-form-item",{attrs:{prop:"publish_unit",label:"出版单位",width:"200"}},[a("span",[t._v(t._s(t.data.publish_unit))])]),t._v(" "),a("el-form-item",{attrs:{prop:"publish_date",label:"出版日期",width:"200"}},[a("span",[t._v(t._s(t.data.publish_date))])]),t._v(" "),a("el-form-item",{attrs:{prop:"bc",label:"版次",width:"100"}},[a("span",[t._v(t._s(t.data.bc))])]),t._v(" "),a("el-form-item",{attrs:{prop:"kcqk",label:"库存情况",width:"100"}},[a("span",[t._v(t._s(t.data.kcqk))])]),t._v(" "),a("el-form-item",{attrs:{prop:"xzlmjzb",label:"通告改增数",width:"100"}},[a("span",[t._v(t._s(t.data.tggzs))])]),t._v(" "),a("el-form-item",{attrs:{prop:"xzlmjzb",label:"新资料面积占比",width:"100"}},[a("span",[t._v(t._s(t.data.xzlmjzb))])]),t._v(" "),a("el-form-item",{attrs:{prop:"remark",label:"备注",width:"200"}},[a("span",[t._v(t._s(t.data.remark))])])],1)},j=[],B={props:{data:{type:Object,default:function(){return{}}}}},L=B,A=(a("9d57"),Object(b["a"])(L,C,j,!1,null,"6ac2db37",null)),E=A.exports,z=a("66a9"),R=a("e610");function N(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function V(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?N(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var q={components:{OlMap:i["a"],LeftBtns:p["a"],RightPanel:c["a"],RightSearch:_,BottomPanel:w["a"],BottomTable:P,DragPanel:$["a"],Popover:E,MapDialog:z["a"],SearchDialog:R["a"]},mixins:[s["a"]],data:function(){return{pageFrom:"map",drawType:"",table:{data:[],show:!1},page:{current:1,total:0},search:{data:{}},drag:{type:"seamap",data:{},id:""},fullscreenLoading:!1,showSearchDialog:!1,treeNodesData:{},changeMapText:!0,getOlmapVectorLayerData:null}},computed:{},watch:{},mounted:function(){this.getPublishUnit(),this.getPortOptions()},methods:{updateSeaMapBottomTableRectangle:function(t){var e=Object.assign(t,this.treeNodesData);this.getMapAndTableData(e)},changeKuangXuanText:function(t){console.log(t),t?(this.changeMapText=!0,this.getNewTableAndmap()):(this.changeMapText=!1,this.getNewTableAndmap())},handleEditTableRow:function(t){this.drag.data=t,this.$refs.dragPanel.handleEdit(t,this.drag.type)},handleDeleteTableRow:function(t){this.drag.data=t,this.$refs.dragPanel.handleCancel(t,this.drag.type)},handleSendTableRow:function(t){this.drag.data=t,this.$refs.dragPanel.handleSend(t,this.drag.type)},getMapAndTableData:function(t){this.fullscreenLoading=!0;var e=this.getMapData(t),a=this.getTableData(t);return Promise.all([e,a])},getMapData:function(t){var e=this;return r["a"].queryMapObject(t).then((function(t){e.fullscreenLoading=!1,t.data.features?e.$refs.olMap.setData(t.data):(e.$refs.olMap.clearJuXing(),e.$message({message:"无地图数据",type:"info"}))}))},getTableData:function(t){var e=this;return r["a"].queryMapList(V(V({},t),{},{page_number:this.page.current})).then((function(t){var a=t.data.total;e.page.total=a,e.$refs.bottomTable.setData(t.data.list,a),t.data.list.length||e.$message({message:"无列表数据",type:"info"})}))},handleMapLoad:function(t){console.log(t),console.log("======================"),this.$refs.leftBtns.init(t)},handleQuery:function(t){var e=this;this.getMapAndTableData(t).then((function(a){e.search.data=t,e.showBottomPanel()}))},selectData:function(t,e){var a=this;this.treeNodesData=t,this.getMapAndTableData(t).then((function(o){a.search.data=t,1===e&&a.showBottomPanel()}))},setTableData:function(t,e){if(this.$refs.bottomTable.setData([]),t&&t.length<=0)return!1;this.page.total=e,this.$refs.bottomTable.setData(t,e),this.$refs.bottomPanel.show(),this.$refs.rightPanel.hide()},showBottomPanel:function(){this.$refs.bottomPanel.show(),this.$refs.rightPanel.hide()},hanldeTableDelete:function(){this.handleQuery(this.search.data)},openCoordinateDialog:function(){this.$refs.mapDialog.openCoordinateDialog()},openAddDialog:function(t){console.log(this.drag.data),this.$refs.mapDialog.openAddSeaMapDialog(this.drag.data,t)},handleExportAll:function(){r["a"].exportMapDataToExcelAll(this.search.data).then((function(t){Object(x["c"])(t,"海图查询结果")}))},getMapDataByID:function(t,e){var a=this;if(!t)return this.handleClearPopover(),!1;var o=t.id_;r["a"].getMapDataInfoByMapID({map_id:o}).then((function(t){var e=t.data.features.map((function(t){return t.properties}));a.drag.data=e[0],a.$refs.dragPanel.show()}))},getAllDataByPolygon:function(t){this.fullscreenLoading=!0;var e=this.getMapDataByPolygon({poly:t}),a=this.getTableDataByPolygon({poly:t});return Promise.all([e,a])},getMapDataByPolygon:function(t){var e=this;return r["a"].getMapObjectByPolygon(t).then((function(t){if(e.fullscreenLoading=!1,t.data.features)return e.$refs.olMap.setData(t.data),t;e.$message({message:"没有数据",type:"info"})}))},getTableDataByPolygon:function(t){var e=this;return r["a"].getMapListByPolygon(V(V({},t),{},{page_number:this.page.current})).then((function(t){var a=t.data.total;e.page.total=a,e.setTableData(t.data.list,a)}))},handleOpenDialog:function(t){console.log(t),"coordinate"===t?this.openCoordinateDialog():"add"===t&&this.openAddDialog("add")},handleEditMap:function(){this.openAddDialog("edit")},handleGetFeature:function(t){this.drag.data=t},handleClearPopover:function(){this.$refs.dragPanel.hide()},handleCloseDrag:function(){this.$refs.leftBtns.clearClickControl()},handleCurrentChange:function(t){this.page.current=t,this.getTableData({})},hanldeBottomPanelDelete:function(){this.$refs.bottomTable.handleDelete()},hanldeBottomPanelExport:function(){this.$refs.bottomTable.handleExport()},handleUpdateDragData:function(t){this.drag.data=t,this.$refs.bottomTable.updateData(t)},getNewTableAndmap:function(){this.getMapAndTableData(this.treeNodesData)},showTopSearchDialog:function(){this.showSearchDialog=!0},changeSearchDialog:function(){this.showSearchDialog=!1},searchSeamapData:function(t){var e=this;this.getMapAndTableData(t).then((function(a){e.search.data=t,e.showBottomPanel(),e.showSearchDialog=!1}))},getVectorLayer:function(t){this.getOlmapVectorLayerData=t},handleDrawType:function(t){console.log(t),this.drawType=t}}},F=q,I=(a("ab9b"),Object(b["a"])(F,o,l,!1,null,"6d78105f",null));e["default"]=I.exports},f4d6:function(t,e,a){}}]);